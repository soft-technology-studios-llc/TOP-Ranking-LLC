
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Breaker: Baseball Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #05050a;
            font-family: 'Arial Black', sans-serif;
            touch-action: none;
            user-select: none;
        }
        canvas { display: block; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        
        #ui {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 20px;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            color: white;
        }

        #rblx-bubble {
            position: absolute;
            bottom: 30px; right: 30px;
            width: 85px; height: 85px;
            background: linear-gradient(135deg, #ff00ff, #7000ff);
            border-radius: 20px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: white; font-weight: bold;
            box-shadow: 0 15px 35px rgba(112, 0, 255, 0.4), inset 0 0 15px rgba(255,255,255,0.5);
            z-index: 2000; cursor: pointer;
            border: 2px solid white;
            animation: bounce 2s infinite;
            pointer-events: auto;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) rotate(5deg); }
            50% { transform: translateY(-15px) rotate(-5deg); }
        }

        #transfer-modal {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
            z-index: 3000; padding: 20px;
        }

        .btn-premium {
            background: white; color: black;
            padding: 15px 40px; border-radius: 12px;
            font-weight: 900; cursor: pointer; border: none;
            transition: 0.2s; box-shadow: 0 5px 0 #999;
        }
        .btn-premium:active { transform: translateY(3px); box-shadow: 0 2px 0 #999; }

        #reward-popup {
            position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem; font-weight: 900;
            color: #4ade80; text-shadow: 3px 3px 0 #064e3b, 0 0 30px rgba(74, 222, 128, 0.5);
            pointer-events: none; opacity: 0; z-index: 5000;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="glass-panel text-center">
            <div class="text-xs text-gray-400">SCORE</div>
            <div id="score" class="text-2xl font-black">0</div>
        </div>
        <div class="glass-panel text-center border-red-500/30">
            <div id="lives" class="text-xl font-black text-red-500 italic">5 VIDAS</div>
        </div>
    </div>

    <div id="rblx-bubble">
        <span class="text-[10px] opacity-80">RBLX</span>
        <span id="rblx-count" class="text-2xl font-black">0</span>
    </div>

    <div id="reward-popup">+1 RBLX</div>

    <div id="overlay" class="bg-black/90 fixed inset-0 z-[1000] flex flex-col items-center justify-center">
        <h1 class="text-6xl font-black text-white mb-4 italic tracking-tighter">ULTRA BREAKER</h1>
        <p class="text-purple-400 mb-10 tracking-[0.5em] text-xs">TEXTURES & PHYSICS ENGINE</p>
        <button id="play-btn" class="btn-premium text-2xl px-12">EMPEZAR</button>
    </div>

    <div id="transfer-modal" class="hidden">
        <div class="bg-slate-900 border-2 border-purple-500 p-8 rounded-3xl text-center max-w-sm w-full shadow-2xl">
            <h2 class="text-xl font-bold text-gray-400 mb-2 uppercase">Balance Rblx</h2>
            <div class="text-7xl font-black text-white mb-6" id="modal-rblx-count">0</div>
            
            <button id="ai-btn" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold mb-4 hover:bg-purple-500 transition">
                üß† ESTRATEGIA IA
            </button>
            <div id="ai-suggestion" class="text-sm text-purple-200 italic mb-6 bg-purple-900/30 p-4 rounded-xl border border-purple-500/30 min-h-[60px]">
                Esperando estratega...
            </div>

            <button id="transfer-btn" class="w-full bg-green-500 text-white py-4 rounded-xl font-black text-xl mb-4 hover:bg-green-400 transition">
                TRANSFERIR
            </button>
            <button id="close-modal" class="text-gray-500 font-bold uppercase text-xs tracking-widest">Cerrar</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const apiKey = ""; 
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const rblxEl = document.getElementById('rblx-count');
        const modalRblxEl = document.getElementById('modal-rblx-count');
        const rewardPopup = document.getElementById('reward-popup');
        const overlay = document.getElementById('overlay');
        const transferModal = document.getElementById('transfer-modal');
        const aiBtn = document.getElementById('ai-btn');
        const aiSuggestion = document.getElementById('ai-suggestion');

        let gameActive = false;
        let score = 0;
        let lives = 5;
        let rblxPoints = parseInt(localStorage.getItem('rblxPoints')) || 0;
        let lastRewardScore = 0;
        let bricks = [];
        let particles = [];
        let ballRotation = 0;

        const paddle = { w: 140, h: 22, x: 0, y: 0 };
        const ball = { x: 0, y: 0, r: 10, dx: 0, dy: 0, speed: 7 };

        rblxEl.innerText = rblxPoints;

        // --- GEMINI AI ---
        async function fetchAISuggestion() {
            aiSuggestion.innerText = "Consultando al experto...";
            aiBtn.disabled = true;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `El jugador tiene ${rblxPoints} puntos Rblx y una puntuaci√≥n de ${score}. Dale un consejo de 10 palabras sobre c√≥mo ganar m√°s puntos rompiendo bloques.` }] }],
                        systemInstruction: { parts: [{ text: "Eres un coach de eSports agresivo y motivador." }] }
                    })
                });
                const data = await response.json();
                aiSuggestion.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || "¬°Dale duro a esos ladrillos!";
            } catch (e) {
                aiSuggestion.innerText = "¬°Enf√≥cate! ¬°Cada rebote cuenta para tu fortuna!";
            }
            aiBtn.disabled = false;
        }
        aiBtn.onclick = fetchAISuggestion;

        // --- MOTOR GR√ÅFICO ---
        function drawBrick(b) {
            // Sombra del ladrillo
            ctx.shadowColor = 'rgba(0,0,0,0.8)';
            ctx.shadowBlur = 15;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 8;

            // Cuerpo del ladrillo (Textura üß±)
            ctx.fillStyle = b.color;
            ctx.beginPath();
            ctx.roundRect(b.x, b.y, b.w, b.h, 3);
            ctx.fill();

            // Detalles de cemento/ladrillo
            ctx.shadowColor = 'transparent';
            ctx.strokeStyle = 'rgba(0,0,0,0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(b.x, b.y, b.w, b.h);

            // L√≠neas de textura üß±
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath();
            ctx.moveTo(b.x + b.w/2, b.y); ctx.lineTo(b.x + b.w/2, b.y + b.h);
            ctx.moveTo(b.x, b.y + b.h/2); ctx.lineTo(b.x + b.w, b.y + b.h/2);
            ctx.stroke();

            // Brillo superior
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            ctx.fillRect(b.x + 2, b.y + 2, b.w - 4, 3);
        }

        function drawBall() {
            ctx.save();
            ctx.translate(ball.x, ball.y);
            ctx.rotate(ballRotation);

            // Sombra de la pelota proyectada en el fondo
            ctx.shadowColor = 'rgba(0,0,0,0.6)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetY = 15;

            // Pelota de B√©isbol (Blanca)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(0, 0, ball.r, 0, Math.PI*2);
            ctx.fill();

            // Costuras Rojas ‚öæ
            ctx.strokeStyle = '#f00';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(-ball.r*0.8, 0, ball.r, -0.5, 0.5);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(ball.r*0.8, 0, ball.r, Math.PI - 0.5, Math.PI + 0.5);
            ctx.stroke();

            ctx.restore();
            ballRotation += (Math.abs(ball.dx) + Math.abs(ball.dy)) * 0.05;
        }

        function drawPaddle() {
            // Sombra de paleta
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 10;

            let grad = ctx.createLinearGradient(paddle.x, paddle.y, paddle.x, paddle.y + paddle.h);
            grad.addColorStop(0, '#334155');
            grad.addColorStop(0.5, '#94a3b8');
            grad.addColorStop(1, '#1e293b');

            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.roundRect(paddle.x, paddle.y, paddle.w, paddle.h, 12);
            ctx.fill();
            
            // Reflejo met√°lico
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fillRect(paddle.x + 10, paddle.y + 4, paddle.w - 20, 4);
            ctx.shadowBlur = 0;
        }

        // --- L√ìGICA DE JUEGO ---
        function createBricks() {
            const rows = 5, cols = 6, pad = 12;
            const bW = (canvas.width - 60 - (cols - 1) * pad) / cols;
            const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'];
            bricks = [];
            for(let r = 0; r < rows; r++) {
                for(let c = 0; c < cols; c++) {
                    bricks.push({
                        x: c * (bW + pad) + 30,
                        y: r * (28 + pad) + 120,
                        w: bW, h: 28, color: colors[r], active: true
                    });
                }
            }
        }

        function update() {
            if(!gameActive) return;

            ball.x += ball.dx;
            ball.y += ball.dy;

            // Colisiones bordes
            if(ball.x + ball.r > canvas.width || ball.x - ball.r < 0) {
                ball.dx *= -1.02; // Aceleraci√≥n leve
                ball.x = ball.x < ball.r ? ball.r : canvas.width - ball.r;
            }
            if(ball.y - ball.r < 0) ball.dy *= -1;

            // Colisi√≥n Paleta
            if(ball.y + ball.r > paddle.y && ball.y - ball.r < paddle.y + paddle.h &&
               ball.x + ball.r > paddle.x && ball.x - ball.r < paddle.x + paddle.w) {
                let hit = (ball.x - (paddle.x + paddle.w/2)) / (paddle.w/2);
                ball.dx = hit * ball.speed * 1.2;
                ball.dy = -Math.abs(ball.speed);
                ball.y = paddle.y - ball.r;
            }

            // Puntos RBLX
            if (score > 0 && score % 300 === 0 && score !== lastRewardScore) {
                lastRewardScore = score;
                rblxPoints++;
                localStorage.setItem('rblxPoints', rblxPoints);
                rblxEl.innerText = rblxPoints;
                rewardPopup.style.opacity = 1;
                setTimeout(() => rewardPopup.style.opacity = 0, 2000);
            }

            // Bloques con colisi√≥n f√≠sica realista
            for(let b of bricks) {
                if(b.active && ball.x + ball.r > b.x && ball.x - ball.r < b.x + b.w &&
                   ball.y + ball.r > b.y && ball.y - ball.r < b.y + b.h) {
                    
                    let prevX = ball.x - ball.dx;
                    if (prevX + ball.r <= b.x || prevX - ball.r >= b.x + b.w) ball.dx *= -1;
                    else ball.dy *= -1;
                    
                    b.active = false;
                    score += 10;
                    scoreEl.innerText = score;

                    // Animaci√≥n de escombros üß±
                    for(let i=0; i<8; i++) {
                        particles.push({
                            x: b.x + b.w/2, y: b.y + b.h/2,
                            dx: (Math.random()-0.5)*12, dy: (Math.random()-0.5)*12,
                            size: Math.random()*6 + 2, life: 1, color: b.color
                        });
                    }
                    if(bricks.every(x => !x.active)) createBricks();
                    break;
                }
            }

            if(ball.y > canvas.height) {
                lives--;
                livesEl.innerText = lives + " VIDAS";
                if(lives <= 0) gameActive = false, overlay.classList.remove('hidden');
                else resetBall();
            }

            particles.forEach((p, i) => {
                p.x += p.dx; p.y += p.dy; p.dy += 0.2; p.life -= 0.02;
                if(p.life <= 0) particles.splice(i, 1);
            });
        }

        function resetBall() {
            ball.x = paddle.x + paddle.w/2;
            ball.y = paddle.y - ball.r - 20;
            ball.dx = (Math.random()-0.5)*ball.speed;
            ball.dy = -ball.speed;
        }

        function draw() {
            // Fondo oscuro profundo
            ctx.fillStyle = '#05050a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if(gameActive) {
                bricks.forEach(b => { if(b.active) drawBrick(b); });
                drawPaddle();
                drawBall();
                
                particles.forEach(p => {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                });
                ctx.globalAlpha = 1;
            }
            update();
            requestAnimationFrame(draw);
        }

        const move = (x) => {
            if(!gameActive) return;
            paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, x - paddle.w/2));
        };
        window.addEventListener('mousemove', e => move(e.clientX));
        window.addEventListener('touchmove', e => { move(e.touches[0].clientX); e.preventDefault(); }, {passive:false});

        document.getElementById('play-btn').onclick = () => {
            overlay.classList.add('hidden');
            score = 0; lives = 5; lastRewardScore = 0;
            scoreEl.innerText = 0; livesEl.innerText = "5 VIDAS";
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            paddle.y = canvas.height - 80;
            createBricks(); resetBall();
            gameActive = true;
        };

        document.getElementById('rblx-bubble').onclick = () => {
            modalRblxEl.innerText = rblxPoints;
            transferModal.classList.remove('hidden');
        };

        document.getElementById('close-modal').onclick = () => transferModal.classList.add('hidden');

        document.getElementById('transfer-btn').onclick = () => {
            const msg = encodeURIComponent(`Tengo ${rblxPoints} por lo cual quiero canjear por puntos Rblx`);
            window.open(`https://wa.me/50373826693?text=${msg}`, '_blank');
        };

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            paddle.y = canvas.height - 80;
        });

        draw();
    </script>
</body>
</html>